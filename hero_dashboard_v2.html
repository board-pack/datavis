<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Performance Dashboard 2023-2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --accent-purple: #8b5cf6;
            --accent-blue: #06b6d4;
            --bg-dark: #0a0f1a;
            --bg-card: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 60px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            margin-bottom: 50px;
            animation: slideDown 0.8s ease-out;
        }
        
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 72px;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            font-weight: 300;
        }
        
        .year-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 50px;
            animation: slideUp 0.8s ease-out 0.2s backwards;
        }
        
        .period-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            animation: slideUp 0.8s ease-out 0.8s backwards;
        }
        
        .year-btn, .period-btn {
            padding: 12px 32px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Poppins', sans-serif;
        }
        
        .period-btn {
            padding: 10px 24px;
            font-size: 14px;
        }
        
        .year-btn:hover, .period-btn:hover {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }
        
        .year-btn.active, .period-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.8s ease-out backwards;
        }
        
        .metric-card:nth-child(1) { animation-delay: 0.3s; }
        .metric-card:nth-child(2) { animation-delay: 0.4s; }
        .metric-card:nth-child(3) { animation-delay: 0.5s; }
        .metric-card:nth-child(4) { animation-delay: 0.6s; }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .metric-card:hover::before {
            opacity: 1;
        }
        
        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .metric-label {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        .metric-value {
            font-family: 'Poppins', sans-serif;
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .metric-change {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .metric-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary);
        }
        
        .metric-change.neutral {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-secondary);
        }
        
        .comparison-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 60px;
            animation: fadeIn 0.8s ease-out 0.7s backwards;
        }
        
        .expense-breakdown {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 60px;
            animation: fadeIn 0.8s ease-out 0.75s backwards;
        }
        
        .expense-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 60px;
            align-items: start;
            margin-bottom: 40px;
        }
        
        .expense-chart-container {
            position: relative;
            height: 400px;
        }
        
        .expense-categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .expense-category {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 28px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .expense-category::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--exp-color);
        }
        
        .expense-category:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .expense-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .expense-category-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .expense-category-percentage {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--exp-color);
        }
        
        .expense-category-value {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .expense-insight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 24px 32px;
            text-align: center;
        }
        
        .expense-insight p {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            margin: 0;
        }
        
        .expense-insight strong {
            color: #10b981;
            font-weight: 700;
        }
        
        .revenue-breakdown {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 60px;
            animation: fadeIn 0.8s ease-out 0.5s backwards;
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--text-primary);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
        }
        
        .comparison-item {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .comparison-item:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-4px);
        }
        
        .comparison-year {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .comparison-value {
            font-family: 'Poppins', sans-serif;
            font-size: 42px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .comparison-label {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
        }
        
        .breakdown-content {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 60px;
            align-items: start;
        }
        
        .breakdown-chart {
            position: relative;
            height: 450px;
        }
        
        .breakdown-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .breakdown-category {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .breakdown-category::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--cat-color);
        }
        
        .breakdown-category:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .breakdown-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .breakdown-category-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .breakdown-category-percentage {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--cat-color);
        }
        
        .breakdown-category-value {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .client-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 16px;
            min-width: 250px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .client-tooltip.show {
            opacity: 1;
        }
        
        .client-tooltip-title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .client-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }
        
        .client-item:last-child {
            border-bottom: none;
        }
        
        .client-name {
            color: var(--text-primary);
        }
        
        .client-amount {
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .insight-banner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(6, 182, 212, 0.15) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 40px 50px;
            text-align: center;
            animation: fadeIn 0.8s ease-out 0.9s backwards;
        }
        
        .insight-text {
            font-size: 28px;
            font-weight: 300;
            line-height: 1.6;
            color: var(--text-primary);
        }
        
        .insight-text strong {
            font-weight: 700;
            color: var(--primary);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @media (max-width: 1400px) {
            .breakdown-content {
                grid-template-columns: 1fr;
            }
            
            .breakdown-categories {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .expense-content {
                grid-template-columns: 1fr;
            }
            
            .expense-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 40px 30px;
            }
            
            h1 {
                font-size: 56px;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Financial Performance</h1>
            <p class="subtitle">Comprehensive Performance Dashboard | 2023-2025</p>
        </div>
        
        <div class="year-selector">
            <button class="year-btn" data-year="2023">2023</button>
            <button class="year-btn" data-year="2024">2024</button>
            <button class="year-btn active" data-year="2025">2025</button>
            <button class="year-btn" data-year="all">All Years</button>
        </div>
        
        <div class="metrics-grid" id="metricsGrid">
            <!-- Metrics will be populated by JavaScript -->
        </div>
        
        <div class="comparison-section" id="comparisonSection">
            <h2 class="section-title" id="comparisonTitle">Three-Year Revenue Progression</h2>
            <div class="comparison-grid" id="revenueComparison">
                <div class="comparison-item">
                    <div class="comparison-year">2023</div>
                    <div class="comparison-value" data-count="836178">$0</div>
                    <div class="comparison-label">Revenue (Jan-Oct)</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2024</div>
                    <div class="comparison-value" data-count="952174">$0</div>
                    <div class="comparison-label">Revenue (Jan-Oct)</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2025</div>
                    <div class="comparison-value" data-count="1107896">$0</div>
                    <div class="comparison-label">Revenue (Jan-Oct)</div>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 50px;" id="profitComparisonTitle">Net Profit Progression</h2>
            <div class="comparison-grid" id="profitComparison">
                <div class="comparison-item">
                    <div class="comparison-year">2023</div>
                    <div class="comparison-value" data-count="146778">$0</div>
                    <div class="comparison-label">Net Profit (Jan-Oct)</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2024</div>
                    <div class="comparison-value" data-count="193855">$0</div>
                    <div class="comparison-label">Net Profit (Jan-Oct)</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2025</div>
                    <div class="comparison-value" data-count="263804">$0</div>
                    <div class="comparison-label">Net Profit (Jan-Oct)</div>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 50px;" id="marginComparisonTitle">Profit Margin Progression</h2>
            <div class="comparison-grid" id="marginComparison">
                <div class="comparison-item">
                    <div class="comparison-year">2023</div>
                    <div class="comparison-value">17.6%</div>
                    <div class="comparison-label">Net Margin</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2024</div>
                    <div class="comparison-value">20.4%</div>
                    <div class="comparison-label">Net Margin</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-year">2025</div>
                    <div class="comparison-value">23.8%</div>
                    <div class="comparison-label">Net Margin</div>
                </div>
            </div>
        </div>
        
        <div class="expense-breakdown" id="expenseBreakdown">
            <h2 class="section-title">Expense Breakdown</h2>
            <div class="expense-content">
                <div class="expense-chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
                <div class="expense-categories" id="expenseCategories">
                    <!-- Expense categories will be populated by JavaScript -->
                </div>
            </div>
            <div class="expense-insight" id="expenseInsight">
                <p>People costs represent 70% of total expenses, reflecting our investment in talent. Operating expenses grew 22% while headcount grew 56%.</p>
            </div>
        </div>
        
        <div class="period-selector" id="periodSelector">
            <button class="period-btn" data-period="Q1">Q1</button>
            <button class="period-btn" data-period="Q2">Q2</button>
            <button class="period-btn" data-period="Q3">Q3</button>
            <button class="period-btn" data-period="Q4">Q4</button>
            <button class="period-btn active" data-period="YTD">All Quarters</button>
        </div>
        
        <div class="revenue-breakdown" id="revenueBreakdown">
            <h2 class="section-title">Revenue Breakdown</h2>
            <div class="breakdown-content">
                <div class="breakdown-chart">
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="breakdown-categories" id="breakdownCategories">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="insight-banner" id="revenueInsight">
            <p class="insight-text">
                We're growing profit <strong>faster</strong> than revenue: our business model is getting more <strong>efficient at scale</strong>
            </p>
        </div>
    </div>
    
    <!-- Client tooltip -->
    <div class="client-tooltip" id="clientTooltip"></div>
    
    <script>
        // Financial data
        const data = {
            2023: {
                revenue: 836178,
                expenses: 689400,
                netProfit: 146778,
                margin: 17.6,
                headcount: 45
            },
            2024: {
                revenue: 952174,
                expenses: 758319,
                netProfit: 193855,
                margin: 20.4,
                headcount: 50
            },
            2025: {
                revenue: 1107896,
                expenses: 844092,
                netProfit: 263804,
                margin: 23.8,
                headcount: 60
            }
        };
        
        // Expense data by category
        const expenseData = {
            2023: {
                total: 689400,
                categories: {
                    "People Cost": 485400,
                    "Software Cost": 154000,
                    "Sales & Marketing": 50000
                }
            },
            2024: {
                total: 758319,
                categories: {
                    "People Cost": 533400,
                    "Software Cost": 169419,
                    "Sales & Marketing": 55500
                }
            },
            2025: {
                total: 844092,
                categories: {
                    "People Cost": 594811,
                    "Software Cost": 189281,
                    "Sales & Marketing": 60000
                }
            }
        };
        
        // Revenue data will be loaded below
        let revenueData = null;
        let currentRevenueChart = null;
        let currentExpenseChart = null;
        let currentYear = '2025';
        let currentPeriod = 'YTD';
        
        const categoryColors = {
            'Product': '#10b981',
            'Enterprise': '#06b6d4',
            'CMS': '#8b5cf6',
            'Outsourcing': '#ec4899',
            'Support': '#f59e0b',
            'Buy-out': '#6b7280',
            'Other': '#9ca3af'
        };
        
        const expenseColors = {
            'People Cost': '#10b981',
            'Software Cost': '#06b6d4',
            'Sales & Marketing': '#8b5cf6'
        };
        
        function formatCurrency(num) {
            if (num >= 1000000) {
                return '$' + (num / 1000000).toFixed(2) + 'M';
            }
            return '$' + (num / 1000).toFixed(0) + 'K';
        }
        
        function animateValue(element, start, end, duration, isPercentage = false, isCurrency = true) {
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * easeOutQuart;
                
                if (isCurrency) {
                    element.textContent = formatCurrency(current);
                } else if (isPercentage) {
                    element.textContent = current.toFixed(1) + '%';
                } else {
                    element.textContent = Math.round(current);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
        
        function animateValueWithSuffix(element, start, end, duration, isPercentage = false, suffix = '') {
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * easeOutQuart;
                
                if (isPercentage) {
                    element.textContent = current.toFixed(1) + '%';
                } else if (suffix) {
                    element.textContent = current.toFixed(1) + suffix;
                } else {
                    element.textContent = Math.round(current);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
        
        function calculateChange(current, previous) {
            return ((current - previous) / previous * 100).toFixed(1);
        }
        
        function renderMetrics(year) {
            const metricsGrid = document.getElementById('metricsGrid');
            
            if (year === 'all') {
                const metrics = [
                    {
                        label: 'Revenue Growth',
                        value: ((data[2025].revenue - data[2023].revenue) / data[2023].revenue * 100),
                        sublabel: '$836K → $1.1M (2023-2025)',
                        isPercentage: true,
                        isCurrency: false
                    },
                    {
                        label: 'Profit Growth',
                        value: ((data[2025].netProfit - data[2023].netProfit) / data[2023].netProfit * 100),
                        sublabel: '$147K → $264K (2023-2025)',
                        isPercentage: true,
                        isCurrency: false
                    },
                    {
                        label: 'Margin Expansion',
                        value: data[2025].margin - data[2023].margin,
                        sublabel: '17.6% → 23.8% (2023-2025)',
                        isPercentage: false,
                        isCurrency: false,
                        suffix: 'pp'
                    },
                    {
                        label: 'Team Growth',
                        value: ((data[2025].headcount - data[2023].headcount) / data[2023].headcount * 100),
                        sublabel: '45 → 60 people (2023-2025)',
                        isPercentage: true,
                        isCurrency: false
                    }
                ];
                
                metricsGrid.innerHTML = metrics.map((metric, index) => `
                    <div class="metric-card">
                        <div class="metric-label">${metric.label}</div>
                        <div class="metric-value" data-value="${metric.value}" data-is-percentage="${metric.isPercentage}" data-is-currency="false" data-suffix="${metric.suffix || ''}">
                            0${metric.isPercentage ? '%' : (metric.suffix || '')}
                        </div>
                        <div class="metric-change neutral">
                            <span>${metric.sublabel}</span>
                        </div>
                    </div>
                `).join('');
                
                setTimeout(() => {
                    document.querySelectorAll('.metric-value').forEach(el => {
                        const value = parseFloat(el.dataset.value);
                        const isPercentage = el.dataset.isPercentage === 'true';
                        const suffix = el.dataset.suffix;
                        animateValueWithSuffix(el, 0, value, 1500, isPercentage, suffix);
                    });
                }, 100);
                
                return;
            }
            
            const yearData = data[year];
            const previousYear = year - 1;
            const previousData = data[previousYear];
            
            const metrics = [
                {
                    label: 'Total Revenue',
                    value: yearData.revenue,
                    change: previousData ? calculateChange(yearData.revenue, previousData.revenue) : null,
                    isCurrency: true
                },
                {
                    label: 'Total Expenses',
                    value: yearData.expenses,
                    change: previousData ? calculateChange(yearData.expenses, previousData.expenses) : null,
                    isCurrency: true
                },
                {
                    label: 'Net Profit',
                    value: yearData.netProfit,
                    change: previousData ? calculateChange(yearData.netProfit, previousData.netProfit) : null,
                    isCurrency: true
                },
                {
                    label: 'Net Margin',
                    value: yearData.margin,
                    change: previousData ? (yearData.margin - previousData.margin).toFixed(1) + 'pp' : null,
                    isPercentage: true,
                    isCurrency: false
                }
            ];
            
            metricsGrid.innerHTML = metrics.map((metric, index) => `
                <div class="metric-card">
                    <div class="metric-label">${metric.label}</div>
                    <div class="metric-value" data-value="${metric.value}" data-is-percentage="${metric.isPercentage || false}" data-is-currency="${metric.isCurrency}">
                        ${metric.isCurrency ? '$0' : (metric.isPercentage ? '0%' : '0')}
                    </div>
                    ${metric.change ? `
                        <div class="metric-change positive">
                            <span>↑</span>
                            <span>${metric.change}${metric.change.includes('pp') ? '' : '%'} YoY</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            setTimeout(() => {
                document.querySelectorAll('.metric-value').forEach(el => {
                    const value = parseFloat(el.dataset.value);
                    const isPercentage = el.dataset.isPercentage === 'true';
                    const isCurrency = el.dataset.isCurrency === 'true';
                    animateValue(el, 0, value, 1500, isPercentage, isCurrency);
                });
            }, 100);
        }
        
        function showClientTooltip(event, clients, categoryName) {
            const tooltip = document.getElementById('clientTooltip');
            
            const topClients = Object.entries(clients)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            tooltip.innerHTML = `
                <div class="client-tooltip-title">Top Clients - ${categoryName}</div>
                ${topClients.map(([name, amount]) => `
                    <div class="client-item">
                        <span class="client-name">${name}</span>
                        <span class="client-amount">${formatCurrency(amount)}</span>
                    </div>
                `).join('')}
            `;
            
            tooltip.style.left = event.pageX + 20 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.add('show');
        }
        
        function hideClientTooltip() {
            const tooltip = document.getElementById('clientTooltip');
            tooltip.classList.remove('show');
        }
        
        function renderRevenueBreakdown(year, period) {
            if (!revenueData || !revenueData[year] || !revenueData[year][period]) {
                console.error('No revenue data for', year, period);
                return;
            }
            
            const periodData = revenueData[year][period];
            const categories = periodData.categories || {};
            const clients = periodData.clients || {};
            const total = periodData.total || 0;
            
            const sortedCategories = Object.entries(categories)
                .sort((a, b) => b[1] - a[1])
                .map(([name, value]) => ({
                    name,
                    value,
                    percentage: (value / total * 100).toFixed(1),
                    color: categoryColors[name] || '#9ca3af',
                    clients: clients[name] || {}
                }));
            
            // Render category cards
            const categoriesContainer = document.getElementById('breakdownCategories');
            categoriesContainer.innerHTML = sortedCategories.map(cat => `
                <div class="breakdown-category" style="--cat-color: ${cat.color}" 
                     data-category="${cat.name}"
                     onmouseenter="showCategoryClients(event, '${cat.name}')"
                     onmouseleave="hideClientTooltip()">
                    <div class="breakdown-category-header">
                        <span class="breakdown-category-name">${cat.name}</span>
                        <span class="breakdown-category-percentage">${cat.percentage}%</span>
                    </div>
                    <div class="breakdown-category-value">${formatCurrency(cat.value)}</div>
                </div>
            `).join('');
            
            // Render donut chart
            if (currentRevenueChart) {
                currentRevenueChart.destroy();
            }
            
            const ctx = document.getElementById('revenueChart');
            currentRevenueChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedCategories.map(c => c.name),
                    datasets: [{
                        data: sortedCategories.map(c => c.value),
                        backgroundColor: sortedCategories.map(c => c.color),
                        borderWidth: 0,
                        spacing: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            padding: 16,
                            titleFont: {
                                size: 16,
                                weight: 'bold',
                                family: "'Poppins', sans-serif"
                            },
                            bodyFont: {
                                size: 14,
                                family: "'Poppins', sans-serif"
                            },
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = (value / total * 100).toFixed(1);
                                    return `${context.label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // Make showCategoryClients available globally
        window.showCategoryClients = function(event, categoryName) {
            if (!revenueData) return;
            const periodData = revenueData[currentYear][currentPeriod];
            const clients = periodData.clients[categoryName] || {};
            showClientTooltip(event, clients, categoryName);
        };
        
        // Load revenue data - embedded directly
        // Load revenue data - 2023-2024: Client-based, 2025: Pie Chart (Q3 & YTD)
        
        revenueData = {"2023":{"Q1":{"total":231157.63847435065,"categories":{"Enterprise":55673.37951852733,"Outsourcing":112059.22088353413,"CMS":23104.475823293174,"Support":7500.0,"Product":32820.562248995986},"clients":{"Enterprise":{"Word Dev":15900.0,"Clearspace":27718.875502008035,"Jigsaw":6262.289156626506,"AuctionTale":1527.1546189289222,"Climeta":2265.0602409638554,"Peak":2000.0},"Outsourcing":{"Voodoo":8471.385542168675,"ITVET":22604.064257028112,"Ebi":24592.77108433735,"GAP":3300.0,"5874":8700.0,"Zuhike":9830.0,"Sourcefit":30561.0,"Xenia":4000.0},"CMS":{"Stackzzon (techgro)":2363.4538152610444,"KPLMPG Map":1602.409638554217,"KPLMPG Web":2485.0,"Method Resource":1115.0,"Method IT":625.0,"McMullen":253.0120481927711,"GPD":4118.4738955823295,"Conversion":3900.6024096385545,"WA Productions":1500.0,"Slam":1390.52,"KPLMPG Dev":825.0,"Method Meg":1600.0,"Quarterone":251.00401606425706,"MethodIT":1075.0},"Support":{"Rochemartin":7500.0},"Product":{"Contained":32820.562248995986}}},"Q2":{"total":250212.31541666668,"categories":{"Enterprise":50901.16666666667,"Outsourcing":113336.13541666667,"CMS":31732.93,"Product":44242.083333333336,"Support":10000.0},"clients":{"Enterprise":{"Word Dev":10600.0,"Clearspace":15658.333333333332,"Jigsaw":1514.5833333333333,"Climeta":3281.25,"Product HQ":3250.0,"MainMenu":7000.0,"Peak":2700.0,"Derec":6897.0},"Outsourcing":{"Voodoo":2225.927083333333,"ITVET":22313.75,"Ebi":42421.458333333336,"Sourcefit":36375.0,"Xenia":10000.0},"CMS":{"GPD":1265.625,"Conversion":9950.5,"Slam":962.63,"Method Meg":200.0,"StackZone":5721.875,"Blossom":8169.3,"Method IT":2485.0,"Sphere":2978.0},"Product":{"Contained":44242.083333333336},"Support":{"Rochemartin":10000.0}}},"Q3":{"total":268742.09010165354,"categories":{"Enterprise":57387.649905644976,"Outsourcing":140967.77848200218,"CMS":12410.457317073171,"Product":50476.204396933215,"Support":7500.0},"clients":{"Enterprise":{"Word Dev":15900.0,"Jigsaw":2588.756657147268,"Derec":31061.0,"Michael Lahr":3632.608695652174,"Climeta":830.2845528455285,"Stretch Finance":1250.0,"Common Health":2125.0},"Outsourcing":{"Voodoo":11347.306267366472,"ITVET":27692.83517289287,"Ebi":53552.572939178746,"Sourcefit":40560.0,"Xenia":3450.0,"Long Ball":262.5,"Mash":4102.5641025641025},"CMS":{"GPD":4853.938329731399,"Slam":290.0,"Conversion":221.51898734177215,"Blossom":5555.0,"Sphere":1490.0},"Product":{"Contained":50476.204396933215},"Support":{"Rochemartin":7500.0}}},"Q4":{"total":283181.82031227485,"categories":{"Outsourcing":156699.26711107648,"CMS":3874.0701170035068,"Enterprise":76372.94713807342,"Product":38735.535946121396,"Support":7500.0},"clients":{"Outsourcing":{"Voodoo":5960.969167834326,"ITVET":37678.71669529743,"Ebi":55277.81506637851,"Sourcefit":35019.0,"Mash":22762.76618156618},"CMS":{"GPD":2142.898845005977,"Conversion":1044.92127199753,"Slam":56.25,"Method IT":630.0},"Enterprise":{"Jigsaw":514.5344242050016,"Stretch Finance":11910.0,"Common Health":6375.0,"Derec":27236.0,"Word Dev":1695.0,"Briix":20095.0,"Clearspace":830.3797468354431,"Michael Lahr":5832.417582417582,"Climeta":384.6153846153846,"Specialized":1500.0},"Product":{"Contained":38735.535946121396},"Support":{"Rochemartin":7500.0}}},"YTD":{"total":836177.6732922328,"categories":{"Enterprise":178590.12292010727,"Outsourcing":418821.0405045295,"CMS":67858.07655500049,"Support":27500.0,"Product":143408.43331259585},"clients":{"Enterprise":{"Word Dev":42400.0,"Clearspace":43377.20883534137,"Jigsaw":10718.555976375403,"AuctionTale":1527.1546189289222,"Climeta":6376.594793809384,"Peak":4700.0,"Product HQ":3250.0,"MainMenu":7000.0,"Derec":48858.0,"Michael Lahr":3632.608695652174,"Stretch Finance":2500.0,"Common Health":4250.0},"Outsourcing":{"Voodoo":24204.99490912864,"ITVET":87975.28357626243,"Ebi":138625.3389422153,"GAP":3300.0,"5874":8700.0,"Zuhike":9830.0,"Sourcefit":120396.0,"Xenia":17450.0,"Long Ball":262.5,"Mash":8076.923076923076},"CMS":{"Stackzzon (techgro)":2363.4538152610444,"KPLMPG Map":1602.409638554217,"KPLMPG Web":2485.0,"Method Resource":1115.0,"Method IT":3110.0,"McMullen":253.0120481927711,"GPD":10637.427469216167,"Conversion":14264.694567712037,"WA Productions":1500.0,"Slam":2661.9,"KPLMPG Dev":825.0,"Method Meg":1800.0,"Quarterone":251.00401606425706,"MethodIT":1075.0,"StackZone":5721.875,"Blossom":13724.3,"Sphere":4468.0},"Support":{"Rochemartin":27500.0},"Product":{"Contained":143408.43331259585}}}},"2024":{"Q1":{"total":276444.36588238657,"categories":{"Enterprise":94935.74731079352,"Outsourcing":137628.42216350033,"CMS":14780.06658011468,"Product":21600.12982797793,"Support":7500.0},"clients":{"Enterprise":{"Word Dev":2496.0,"Jigsaw":367.15352158390135,"Climeta":4377.13458833712,"Stretch Finance":19328.0,"Derec":17266.06,"Briix":17892.5,"Peak":3522.0,"Michael Lahr":7841.2489249880555,"Specialized":10652.0,"Bridge Housing Solutions":2877.1502758844526,"Crypto Weekly":3957.5,"HCGlobal":1500.0,"Dispute Buddy":1407.0,"Common Health":1452.0},"Outsourcing":{"Voodoo":6966.052147571134,"ITVET":8909.298928919183,"Ebi":56587.63388510223,"Sourcefit":44845.0,"Mash":15250.43720190779,"Damen & Division":5070.0},"CMS":{"GPD":1812.2665801146813,"Slam":1087.5,"Blossom":7654.8,"Sphere":2982.0,"WingWai":544.5,"Emerald Lane":699.0},"Product":{"Contained":21600.12982797793},"Support":{"Rochemartin":7500.0}}},"Q2":{"total":294533.67893181037,"categories":{"Enterprise":117171.5727872956,"Outsourcing":121075.70266350212,"CMS":9118.681962025315,"Product":32167.721518987342,"Support":15000.0},"clients":{"Enterprise":{"Word Dev":805.5,"Stretch Finance":36540.0,"Derec":10248.0,"Crypto Weekly":1550.0,"Peak":17346.57,"Michael Lahr":5750.009116409537,"Specialized":11000.0,"Bridge Housing Solutions":14545.493670886077,"Dispute Buddy":4600.0,"Common Health":14786.0},"Outsourcing":{"Voodoo":10726.661524261603,"ITVET":10380.617088607594,"Ebi":57061.4240506329,"Sourcefit":36907.0,"Damen & Division":6000.0},"CMS":{"GPD":2795.1819620253164,"Slam":787.5,"Method IT":1435.0,"WingWai":2750.0,"Emerald Lane":1351.0},"Product":{"Contained":32167.721518987342},"Support":{"Rochemartin":7500.0,"Tottenham":7500.0}}},"Q3":{"total":258431.83588809238,"categories":{"Outsourcing":94701.57238843422,"CMS":25041.780002832635,"Enterprise":79336.45631585106,"Product":51007.43258637995,"Support":8344.594594594595},"clients":{"Outsourcing":{"Voodoo":4739.051340728973,"ITVET":10886.236629657682,"Ebi":38330.2625390257,"Sourcefit":27744.5,"Pathfinder":13001.521879021879},"CMS":{"GPD":6361.701027753659,"Slam":3025.0,"Method IT":250.0,"Sphere":1580.0,"TMG":9450.0,"Ruff":3975.0789750789754,"Emerald Lane":400.0},"Enterprise":{"Jigsaw":53.57142857142857,"Climeta":2815.1354276354277,"Stretch Finance":10540.0,"Derec":2480.0,"Peak":9050.0,"Specialized":19662.0,"Bridge Housing Solutions":15278.249459644194,"Toloka AI":2306.25,"Deazy":13651.25,"HCGlobal":3500.0},"Product":{"Contained":37493.91907286644,"ESG":13513.513513513513},"Support":{"Rochemartin":7500.0,"Tottenham":844.5945945945946}}},"Q4":{"total":362080.38296180626,"categories":{"Outsourcing":75718.17044769575,"CMS":38356.154973423196,"Product":157944.7043432517,"Support":12254.0,"Enterprise":77807.35319743547},"clients":{"Outsourcing":{"Voodoo":5917.838374705464,"ITVET":10514.30215354266,"Ebi":21744.114746013478,"Sourcefit":26610.0,"Pathfinder":10931.915173434161},"CMS":{"GPD":1404.0983067565346,"Slam":3111.0,"Method IT":3343.89,"Sphere":1494.0,"Emerald Lane":561.0,"TMG":16802.166666666664,"Happy Companies":11640.0},"Product":{"Contained":40900.87128061811,"ESG":101923.39306263356,"Zunou":15120.439999999999},"Support":{"Rochemartin":7500.0,"AGY / GG Agency":4634.0,"Lee Stone / Secretbali":120.0},"Enterprise":{"Peak":1800.0,"Specialized":30345.0,"Bridge Housing Solutions":15186.878513891172,"Toloka AI":4312.5,"Deazy":24375.0,"Jigsaw":37.974683544303794,"Irish Ed":1750.0}}},"YTD":{"total":951910.4360269645,"categories":{"Enterprise":320485.97771264147,"Outsourcing":382353.51323275274,"CMS":63627.794995189084,"Product":150544.5554917868,"Support":34898.59459459459},"clients":{"Enterprise":{"Word Dev":3301.5,"Jigsaw":420.7249501553299,"Climeta":7192.270015972547,"Stretch Finance":66408.0,"Derec":29994.06,"Briix":17892.5,"Peak":30118.57,"Michael Lahr":13591.25804139759,"Specialized":51619.0,"Bridge Housing Solutions":36975.594705116026,"Crypto Weekly":5507.5,"HCGlobal":5000.0,"Dispute Buddy":6007.0,"Common Health":16238.0,"Toloka AI":6618.75,"Deazy":23601.25},"Outsourcing":{"Voodoo":25378.46414676084,"ITVET":33741.08771211952,"Ebi":159446.8529422933,"Sourcefit":120784.5,"Mash":15250.43720190779,"Damen & Division":11070.0,"Pathfinder":16682.17122967123},"CMS":{"GPD":11492.69935344344,"Slam":5683.3,"Blossom":7654.8,"Sphere":6056.0,"WingWai":3294.5,"Emerald Lane":3011.0,"Method IT":1841.25,"TMG":18179.166666666668,"Ruff":3975.0789750789754,"Happy Companies":2440.0},"Product":{"Contained":106846.18600424731,"ESG":39487.539487539485,"Zunou":4210.83},"Support":{"Rochemartin":25000.0,"Tottenham":8344.594594594595,"AGY / GG Agency":1554.0}}}},"2025":{"Q1":{"total":342627.36859639996,"categories":{"Outsourcing":100122.67485200001,"CMS":35419.7378988,"Product":78452.5479176,"Enterprise":114994.907928,"Support":13637.5},"clients":{"Outsourcing":{"Voodoo":9973.425649,"ITVET":10428.507497999999,"Pathfinder":14006.556706,"Deazy":14850.0,"Ebi":23089.184998999997,"Sourcefit":27775.0},"CMS":{"GPD":1864.386633,"Slam":150.0,"Sphere":3193.75,"Happy Companies":18684.0,"TMG":10139.5,"Emerald Lane":400.0,"Emerging Comms":598.1012658,"Method IT":390.0},"Product":{"Contained":37990.91984739999,"Zunou":40461.6280702},"Enterprise":{"Peak":2050.0,"Specialized":41976.0,"Toloka AI":4062.5,"Bridge Housing Solutions":20794.930458,"Method IT":1807.68,"ESG":44303.79747},"Support":{"AGY / GG Agency":4200.0,"Rochemartin":7500.0,"Tottenham":1937.5}}},"Q2":{"total":314886.1738311,"categories":{"Enterprise":76063.2902412,"Outsourcing":91422.108257,"CMS":48387.6117578,"Product":72475.32573609999,"Support":11700.0,"Buy-out":14837.837839},"clients":{"Enterprise":{"Jigsaw":444.9222222,"Method IT":4979.41,"Specialized":44187.6,"Deazy":9000.0,"Bridge Housing Solutions":17451.358019},"Outsourcing":{"Voodoo":6487.251802000001,"ITVET":4422.5,"Pathfinder":19993.631231,"Ebi":27557.725223999998,"Sourcefit":32961.0},"CMS":{"GPD":2294.9724724,"Happy Companies":20002.0,"TMG":17131.5,"WingWai":2270.5,"Branchlead":1206.6392851,"Sphere":2982.0,"House of Griff":2500.0000003},"Product":{"Contained":40735.735736099996,"Zunou":31739.59},"Support":{"AGY / GG Agency":4200.0,"Rochemartin":7500.0},"Buy-out":{"ITVET":14837.837839}}},"Q3":{"total":309658.78,"categories":{"Product":90377.03,"Enterprise":88896.64,"CMS":59502.5,"Outsourcing":57772.61,"Support":13110.0},"clients":{"Product":{"Zunou":45495.93,"Contained":40360.36,"Method IT":4520.74},"Enterprise":{"Specialized":31627.56,"Deazy":17004.0,"Bridge Housing Solutions":14992.3,"HRoes":13680.0,"Peak":5259.0,"Clearspace":4783.78,"WA Productions":1550.0},"CMS":{"Happy Companies":26794.0,"TMG":21145.0,"Sphere":4956.0,"Deazy":3388.0,"GPD":3219.5},"Outsourcing":{"Ebi":25708.35,"Sourcefit":21279.0,"Voodoo":6093.8,"Kubeox":4691.46},"Support":{"Rochemartin":8910.0,"AGY / GG Agency":4200.0}}},"Q4":{"total":248422.2263142,"categories":{"CMS":33528.4822806,"Enterprise":81896.96192989999,"Outsourcing":47301.282455700006,"Product":67276.55227999999,"Support":18418.947368},"clients":{"CMS":{"Conversion":2832.236842,"GPD":1857.6754386,"Happy Companies":17437.57,"TMG":9490.0,"Slam":400.0,"Sphere":1511.0},"Enterprise":{"Climeta":2100.0,"Clearspace":4953.9035086,"Specialized":22031.31,"Deazy":25416.0,"Bridge Housing Solutions":14167.3684213,"HRoes":13100.0,"Method IT":128.38},"Outsourcing":{"Voodoo":3495.063158,"Kubeox":6687.5,"Ebi":15267.719297700001,"Sourcefit":21851.0},"Product":{"Contained":30464.912279999997,"Zunou":36811.63999999999},"Support":{"AGY / GG Agency":2800.0,"Tottenham":6578.947368,"Rochemartin":9040.0}}},"YTD":{"total":1107895.69,"categories":{"Product":325655.48,"Outsourcing":277579.17,"Enterprise":272477.76,"CMS":179124.9,"Support":41930.0,"Buy-out":11128.38},"clients":{"Product":{"Zunou":135435.26,"Contained":134218.59,"ESG":44303.8,"Method IT":11697.83},"Outsourcing":{"Sourcefit":93466.0,"Ebi":83776.31,"Pathfinder":34000.19,"Voodoo":24484.74,"ITVET":18560.47},"Enterprise":{"Specialized":128146.36,"Bridge Housing Solutions":58685.95,"Deazy":43008.0,"HRoes":19180.0,"Clearspace":7991.02,"Peak":7309.0,"Toloka AI":4062.5,"WA Productions":1550.0,"Climeta":2100.0,"Jigsaw":444.92},"CMS":{"Happy Companies":75616.69,"TMG":53841.0,"Deazy":11800.0,"Sphere":11131.75,"Tottenham":8516.45,"GPD":8261.54,"WingWai":2270.5,"Branchlead":1206.64,"House of Griff":2500.0,"WA Productions":1550.0,"Conversion":2832.24,"Emerging Comms":598.1,"Emerald Lane":400.0,"Slam":150.0,"Method IT":390.0},"Support":{"Rochemartin":27930.0,"AGY / GG Agency":14000.0},"Buy-out":{"ITVET":11128.38}}}}};
        // Initial render
        renderMetrics(2025);
        renderRevenueBreakdown('2025', 'YTD');
        
        // Animate comparison values (only those with data-count attribute)
        setTimeout(() => {
            document.querySelectorAll('.comparison-value[data-count]').forEach(el => {
                const value = parseInt(el.dataset.count);
                animateValue(el, 0, value, 2000, false, true);
            });
        }, 500);
        
        function renderExpenseBreakdown(year) {
            const yearExpenses = expenseData[year];
            const categories = yearExpenses.categories;
            const total = yearExpenses.total;
            
            // Render category cards
            const categoriesContainer = document.getElementById('expenseCategories');
            const sortedCategories = Object.entries(categories)
                .sort((a, b) => b[1] - a[1])
                .map(([name, value]) => ({
                    name,
                    value,
                    percentage: (value / total * 100).toFixed(1),
                    color: expenseColors[name] || '#9ca3af'
                }));
            
            categoriesContainer.innerHTML = sortedCategories.map(cat => `
                <div class="expense-category" style="--exp-color: ${cat.color}">
                    <div class="expense-category-header">
                        <span class="expense-category-name">${cat.name}</span>
                        <span class="expense-category-percentage">${cat.percentage}%</span>
                    </div>
                    <div class="expense-category-value">${formatCurrency(cat.value)}</div>
                </div>
            `).join('');
            
            // Render stacked area chart showing all three years
            if (currentExpenseChart) {
                currentExpenseChart.destroy();
            }
            
            const ctx = document.getElementById('expenseChart');
            
            // Prepare data for all three years
            const years = ['2023', '2024', '2025'];
            const categoryNames = ['People Cost', 'Software Cost', 'Sales & Marketing'];
            
            const datasets = categoryNames.map(category => ({
                label: category,
                data: years.map(y => expenseData[y].categories[category]),
                backgroundColor: expenseColors[category],
                borderWidth: 0,
                fill: true
            }));
            
            currentExpenseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            padding: 16,
                            titleFont: {
                                size: 16,
                                weight: 'bold',
                                family: "'Poppins', sans-serif"
                            },
                            bodyFont: {
                                size: 14,
                                family: "'Poppins', sans-serif"
                            },
                            callbacks: {
                                title: function(context) {
                                    const year = context[0].label;
                                    const total = expenseData[year].total;
                                    return year + ' - Total: ' + formatCurrency(total);
                                },
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                },
                                footer: function(context) {
                                    const year = context[0].label;
                                    const yearData = expenseData[year];
                                    const total = yearData.total;
                                    
                                    // Calculate percentages
                                    const lines = [];
                                    Object.entries(yearData.categories).forEach(([cat, amt]) => {
                                        const pct = ((amt / total) * 100).toFixed(1);
                                        lines.push(`${cat}: ${pct}%`);
                                    });
                                    
                                    return '\n' + lines.join('\n');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#9ca3af',
                                font: {
                                    size: 14,
                                    family: "'Poppins', sans-serif"
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#9ca3af',
                                font: {
                                    size: 14,
                                    family: "'Poppins', sans-serif"
                                },
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // Initial render
        renderMetrics(2025);
        renderExpenseBreakdown('2025');
        renderRevenueBreakdown('2025', 'YTD');
        
        // Year selector
        document.querySelectorAll('.year-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const year = btn.dataset.year;
                currentYear = year;
                
                const periodSelector = document.getElementById('periodSelector');
                const revenueBreakdown = document.getElementById('revenueBreakdown');
                const expenseBreakdown = document.getElementById('expenseBreakdown');
                const comparisonSection = document.getElementById('comparisonSection');
                const comparisonTitle = document.getElementById('comparisonTitle');
                const revenueComparison = document.getElementById('revenueComparison');
                const profitComparison = document.getElementById('profitComparison');
                const marginComparison = document.getElementById('marginComparison');
                const profitComparisonTitle = document.getElementById('profitComparisonTitle');
                const marginComparisonTitle = document.getElementById('marginComparisonTitle');
                const expenseInsight = document.getElementById('expenseInsight');
                const revenueInsight = document.getElementById('revenueInsight');
                
                if (year === 'all') {
                    periodSelector.style.display = 'none';
                    revenueBreakdown.style.display = 'none';
                    expenseBreakdown.style.display = 'none';
                    comparisonSection.style.display = 'block';
                    comparisonTitle.textContent = 'Three-Year Revenue Progression';
                    profitComparisonTitle.textContent = 'Net Profit Progression';
                    marginComparisonTitle.textContent = 'Profit Margin Progression';
                    expenseInsight.style.display = 'none';
                    revenueInsight.style.display = 'none';
                    
                    // Show all three years for all grids
                    revenueComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$836K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$952K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">$1.11M</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                    `;
                    profitComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$147K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$194K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">$264K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                    `;
                    marginComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">17.6%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">20.4%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">23.8%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                    `;
                    
                    renderMetrics('all');
                } else if (year === '2023') {
                    // 2023: Hide comparison section entirely
                    periodSelector.style.display = 'flex';
                    revenueBreakdown.style.display = 'block';
                    expenseBreakdown.style.display = 'block';
                    comparisonSection.style.display = 'none';
                    expenseInsight.style.display = 'none';
                    revenueInsight.style.display = 'none';
                    renderMetrics(parseInt(year));
                    renderExpenseBreakdown(year);
                    renderRevenueBreakdown(year, currentPeriod);
                } else if (year === '2024') {
                    // 2024: Show 2023 and 2024 comparison
                    periodSelector.style.display = 'flex';
                    revenueBreakdown.style.display = 'block';
                    expenseBreakdown.style.display = 'block';
                    comparisonSection.style.display = 'block';
                    comparisonTitle.textContent = 'Revenue: 2023 vs 2024';
                    profitComparisonTitle.textContent = 'Net Profit: 2023 vs 2024';
                    marginComparisonTitle.textContent = 'Profit Margin: 2023 vs 2024';
                    expenseInsight.style.display = 'none';
                    revenueInsight.style.display = 'none';
                    
                    // Update all comparison grids to show only 2023 and 2024
                    revenueComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$836K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$952K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                    `;
                    profitComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$147K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$194K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                    `;
                    marginComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">17.6%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">20.4%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                    `;
                    
                    renderMetrics(parseInt(year));
                    renderExpenseBreakdown(year);
                    renderRevenueBreakdown(year, currentPeriod);
                } else {
                    // 2025: Show all three years
                    periodSelector.style.display = 'flex';
                    revenueBreakdown.style.display = 'block';
                    expenseBreakdown.style.display = 'block';
                    comparisonSection.style.display = 'block';
                    comparisonTitle.textContent = 'Three-Year Revenue Progression';
                    profitComparisonTitle.textContent = 'Net Profit Progression';
                    marginComparisonTitle.textContent = 'Profit Margin Progression';
                    expenseInsight.style.display = 'block';
                    revenueInsight.style.display = 'block';
                    
                    // Restore full comparison grids
                    revenueComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$836K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$952K</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">$1.11M</div>
                            <div class="comparison-label">Revenue (Jan-Oct)</div>
                        </div>
                    `;
                    profitComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">$147K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">$194K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">$264K</div>
                            <div class="comparison-label">Net Profit (Jan-Oct)</div>
                        </div>
                    `;
                    marginComparison.innerHTML = `
                        <div class="comparison-item">
                            <div class="comparison-year">2023</div>
                            <div class="comparison-value">17.6%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2024</div>
                            <div class="comparison-value">20.4%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-year">2025</div>
                            <div class="comparison-value">23.8%</div>
                            <div class="comparison-label">Net Margin</div>
                        </div>
                    `;
                    
                    renderMetrics(parseInt(year));
                    renderExpenseBreakdown(year);
                    renderRevenueBreakdown(year, currentPeriod);
                }
            });
        });
        
        // Period selector
        document.querySelectorAll('.period-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                currentPeriod = btn.dataset.period;
                renderRevenueBreakdown(currentYear, currentPeriod);
            });
        });
    </script>
</body>
</html>
